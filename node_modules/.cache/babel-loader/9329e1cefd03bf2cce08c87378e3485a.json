{"ast":null,"code":"import defaults from './telemetry';\nimport url from 'url';\nimport base64 from 'base-64';\nimport { fetchWithTimeout } from '../utils/fetchWithTimeout';\nexport default class Client {\n  constructor(options) {\n    const {\n      baseUrl,\n      telemetry = {},\n      token,\n      timeout = 10000\n    } = options;\n    if (!baseUrl) {\n      throw new Error('Missing Auth0 domain');\n    }\n    const {\n      name = defaults.name,\n      version = defaults.version\n    } = telemetry;\n    this.telemetry = {\n      name,\n      version\n    };\n    if (name !== defaults.name) {\n      this.telemetry.env = {};\n      this.telemetry.env[defaults.name] = defaults.version;\n    }\n    const parsed = url.parse(baseUrl);\n    this.baseUrl = parsed.protocol === 'https:' || parsed.protocol === 'http:' ? baseUrl : `https://${baseUrl}`;\n    this.domain = parsed.hostname || baseUrl;\n    if (token) {\n      this.bearer = `Bearer ${token}`;\n    }\n    this.timeout = timeout;\n  }\n  post(path, body) {\n    return this.request('POST', this.url(path), body);\n  }\n  patch(path, body) {\n    return this.request('PATCH', this.url(path), body);\n  }\n  get(path, query) {\n    return this.request('GET', this.url(path, query));\n  }\n  url(path, query) {\n    let includeTelemetry = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;\n    let endpoint = url.resolve(this.baseUrl, path);\n    if (query && query.length !== 0 || includeTelemetry) {\n      const parsed = url.parse(endpoint);\n      parsed.query = query || {};\n      if (includeTelemetry) {\n        parsed.query.auth0Client = this._encodedTelemetry();\n      }\n      endpoint = url.format(parsed);\n    }\n    return endpoint;\n  }\n  request(method, url, body) {\n    const options = {\n      method: method,\n      headers: {\n        Accept: 'application/json',\n        'Content-Type': 'application/json',\n        'Auth0-Client': this._encodedTelemetry()\n      }\n    };\n    if (this.bearer) {\n      options.headers.Authorization = this.bearer;\n    }\n    if (body) {\n      options.body = JSON.stringify(body);\n    }\n    return fetchWithTimeout(url, options, this.timeout).then(response => {\n      const payload = {\n        status: response.status,\n        ok: response.ok,\n        headers: response.headers\n      };\n      return response.json().then(json => {\n        return {\n          ...payload,\n          json\n        };\n      }).catch(() => {\n        return response.text().then(text => {\n          return {\n            ...payload,\n            text\n          };\n        }).catch(() => {\n          return {\n            ...payload,\n            text: response.statusText\n          };\n        });\n      });\n    });\n  }\n  _encodedTelemetry() {\n    return base64.encode(JSON.stringify(this.telemetry));\n  }\n}","map":null,"metadata":{},"sourceType":"module"}