{"ast":null,"code":"import { NativeModules, Platform } from 'react-native';\nimport CredentialsManagerError from './credentialsManagerError';\nimport LocalAuthenticationStrategy from './localAuthenticationStrategy';\nclass CredentialsManager {\n  /**\n   * Construct an instance of CredentialsManager\n   *\n   * @param {String} domain - required - the domain of the credentials to be managed\n   * @param {String} clientId - required - clientId of the credentials to be managed\n   */\n  constructor(domain, clientId) {\n    this.domain = domain;\n    this.clientId = clientId;\n    this.Auth0Module = NativeModules.A0Auth0;\n  }\n\n  /**\n   * Saves the provided credentials\n   *\n   * @param {Object} credentials credential values\n   * @param {String} credentials.idToken required - JWT token that has user claims\n   * @param {String} credentials.accessToken required - token used for API calls\n   * @param {String} credentials.tokenType required - type of the token, ex - Bearer\n   * @param {Number} credentials.expiresIn required - Used to denote when the token will expire from the issued time\n   * @param {String} credentials.refreshToken optional - used to refresh access token\n   * @param {String} credentials.scope optional - represents the scope of the current token\n   * @returns {Promise}\n   */\n  async saveCredentials() {\n    let credentials = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    const validateKeys = ['idToken', 'accessToken', 'tokenType', 'expiresIn'];\n    validateKeys.forEach(key => {\n      if (!credentials[key]) {\n        const json = {\n          error: 'a0.credential_manager.invalid_input',\n          error_description: `${key} cannot be empty`,\n          invalid_parameter: key\n        };\n        throw new CredentialsManagerError({\n          json,\n          status: 0\n        });\n      }\n    });\n    try {\n      await this._ensureCredentialManagerIsInitialized();\n      return await this.Auth0Module.saveCredentials(credentials);\n    } catch (e) {\n      const json = {\n        error: 'a0.credential_manager.invalid',\n        error_description: e.message\n      };\n      throw new CredentialsManagerError({\n        json,\n        status: 0\n      });\n    }\n  }\n\n  /**\n   * Gets the credentials that has already been saved\n   *\n   * @param {String} scope optional - the scope to request for the access token. If null is passed, the previous scope will be kept.\n   * @param {String} minTtl optional - the minimum time in seconds that the access token should last before expiration.\n   * @param {Object} parameters optional - additional parameters to send in the request to refresh expired credentials.\n   * @returns {Promise}\n   */\n  async getCredentials(scope) {\n    let minTtl = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n    let parameters = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n    try {\n      await this._ensureCredentialManagerIsInitialized();\n      const credentials = await this.Auth0Module.getCredentials(scope, minTtl, parameters);\n      return credentials;\n    } catch (e) {\n      const json = {\n        error: 'a0.credential_manager.invalid',\n        error_description: e.message\n      };\n      throw new CredentialsManagerError({\n        json,\n        status: 0\n      });\n    }\n  }\n\n  /**\n   * Enables Local Authentication (PIN, Biometric, Swipe etc) to get the credentials\n   *\n   * @param {String} title optional - the text to use as title in the authentication screen. Passing null will result in using the OS's default value in Android and \"Please authenticate to continue\" in iOS.\n   * @param {String} description Android Only - optional - the text to use as description in the authentication screen. On some Android versions it might not be shown. Passing null will result in using the OS's default value.\n   * @param {String} cancelTitle iOS Only - optional - the cancel message to display on the local authentication prompt.\n   * @param {String} fallbackTitle iOS Only - optional - the fallback message to display on the local authentication prompt after a failed match.\n   * @param {Number} strategy iOS Only - optional - the evaluation policy to use when accessing the credentials. Defaults to LocalAuthenticationStrategy.deviceOwnerWithBiometrics.\n   * @returns {Promise}\n   */\n  async requireLocalAuthentication(title, description, cancelTitle, fallbackTitle) {\n    let strategy = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : LocalAuthenticationStrategy.deviceOwnerWithBiometrics;\n    try {\n      await this._ensureCredentialManagerIsInitialized();\n      if (Platform.OS === 'ios') {\n        await this.Auth0Module.enableLocalAuthentication(title, cancelTitle, fallbackTitle, strategy);\n      } else {\n        await this.Auth0Module.enableLocalAuthentication(title, description);\n      }\n    } catch (e) {\n      const json = {\n        error: 'a0.credential_manager.invalid',\n        error_description: e.message\n      };\n      throw new CredentialsManagerError({\n        json,\n        status: 0\n      });\n    }\n  }\n\n  /**\n   * Returns whether this manager contains a valid non-expired pair of credentials.\n   *\n   * @param {Number} minTtl optional - the minimum time in seconds that the access token should last before expiration\n   */\n  async hasValidCredentials() {\n    let minTtl = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;\n    await this._ensureCredentialManagerIsInitialized();\n    return await this.Auth0Module.hasValidCredentials(minTtl);\n  }\n\n  /**\n   * Delete the stored credentials\n   */\n  async clearCredentials() {\n    await this._ensureCredentialManagerIsInitialized();\n    return await this.Auth0Module.clearCredentials();\n  }\n\n  //private\n  async _ensureCredentialManagerIsInitialized() {\n    const hasValid = await this.Auth0Module.hasValidCredentialManagerInstance();\n    if (!hasValid) {\n      await this.Auth0Module.initializeCredentialManager(this.clientId, this.domain);\n    }\n  }\n}\nexport default CredentialsManager;","map":null,"metadata":{},"sourceType":"module"}